const patterns={generic:[{matches:{1:[{name:"keyword.operator",pattern:/\=|\+/g},{name:"keyword.dot",pattern:/\./g}],2:{name:"string",matches:{name:"constant.character.escape",pattern:/\\('|"){1}/g}}},pattern:/(\(|\s|\[|\=|:|\+|\.|\{|,)(('|")([^\\\1]|\\.)*?(\3))/gm},{name:"comment",pattern:/\/\*[\s\S]*?\*\/|(\/\/|\#)(?!.*('|").*?[^:](\/\/|\#)).*?$/gm},{name:"constant.numeric",pattern:/\b(\d+(\.\d+)?(e(\+|\-)?\d+)?(f|d)?|0x[\da-f]+)\b/gi},{matches:{1:"keyword"},pattern:/\b(and|array|as|b(ool(ean)?|reak)|c(ase|atch|har|lass|on(st|tinue))|d(ef|elete|o(uble)?)|e(cho|lse(if)?|xit|xtends|xcept)|f(inally|loat|or(each)?|unction)|global|if|import|int(eger)?|long|new|object|or|pr(int|ivate|otected)|public|return|self|st(ring|ruct|atic)|switch|th(en|is|row)|try|(un)?signed|var|void|while)(?=\b)/gi},{name:"constant.language",pattern:/true|false|null/g},{name:"keyword.operator",pattern:/\+|\!|\-|&(gt|lt|amp);|\||\*|\=/g},{matches:{1:"function.call"},pattern:/(\w+?)(?=\()/g},{matches:{1:"storage.function",2:"entity.name.function"},pattern:/(function)\s(.*?)(?=\()/g}],python:[{name:"variable.self",pattern:/self/g},{name:"constant.language",pattern:/None|True|False|NotImplemented|\.\.\./g},{name:"support.object",pattern:/object/g},{name:"support.function.python",pattern:/\b(bs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|bin|file|iter|property|tuple|bool|filter|len|range|type|bytearray|float|list|raw_input|unichr|callable|format|locals|reduce|unicode|chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|__import__|complex|hash|min|set|apply|delattr|help|next|setattr|buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern)(?=\()/g},{matches:{1:"keyword"},pattern:/\b(pass|lambda|with|is|not|in|from|elif|raise|del)(?=\b)/g},{matches:{1:"storage.class",2:"entity.name.class",3:"entity.other.inherited-class"},pattern:/(class)\s+(\w+)\((\w+?)\)/g},{matches:{1:"storage.function",2:"support.magic"},pattern:/(def)\s+(__\w+)(?=\()/g},{name:"support.magic",pattern:/__(name)__/g},{matches:{1:"keyword.control",2:"support.exception.type"},pattern:/(except) (\w+):/g},{matches:{1:"storage.function",2:"entity.name.function"},pattern:/(def)\s+(\w+)(?=\()/g},{name:"entity.name.function.decorator",pattern:/@([\w\.]+)/g},{name:"comment.docstring",pattern:/('{3}|"{3})[\s\S]*?\1/gm}]};function replaceAtPosition(position,replace,replaceWith,code){const subString=code.substr(position);replaceWith=replaceWith.replace(/\$/g,"$$$$");return code.substr(0,position)+subString.replace(replace,replaceWith)}function indexOfGroup(match,groupNumber){let index=0;for(let i=1;i<groupNumber;++i){if(match[i]){index+=match[i].length}}return index}function keys(object){const locations=[];for(const location in object){if(object.hasOwnProperty(location)){locations.push(location)}}return locations.sort(((a,b)=>b-a))}function htmlEntities(code){return code.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&(?![\w\#]+;)/g,"&amp;")}function hasCompleteOverlap(start1,end1,start2,end2){if(start2===start1&&end2===end1){return false}return start2<=start1&&end2>=end1}function intersects(start1,end1,start2,end2){if(start2>=start1&&start2<end1){return true}return end2>start1&&end2<end1}class Prism{constructor(patterns){this.patterns=patterns;const replacements={};let currentLanguage;const replacementPositions={};function _matchIsInsideOtherMatch(start,end){for(let key in replacementPositions){key=parseInt(key,10);if(hasCompleteOverlap(key,replacementPositions[key],start,end)){delete replacementPositions[key];delete replacements[key]}if(intersects(key,replacementPositions[key],start,end)){return true}}return false}function _wrapCodeInSpan(name,code){let className=name.replace(/\./g," ");return`<span class="${className}">${code}</span>`}function _processReplacements(code){const positions=keys(replacements);for(const position of positions){const replacement=replacements[position];code=replaceAtPosition(position,replacement.replace,replacement.with,code)}return code}function _cloneRegex(regex){let flags="";if(regex.ignoreCase){flags+="i"}if(regex.multiline){flags+="m"}return new RegExp(regex.source,flags)}function _processPattern(instance,pattern,code,offset=0){let regex=pattern.pattern;if(!regex){return false}const shouldStop=!regex.global;regex=_cloneRegex(regex);const match=regex.exec(code);if(!match){return false}if(!pattern.name&&pattern.matches&&typeof pattern.matches[0]==="string"){pattern.name=pattern.matches[0];delete pattern.matches[0]}let replacement=match[0];const startPos=match.index+offset;const endPos=match[0].length+startPos;if(startPos===endPos){return false}if(_matchIsInsideOtherMatch(startPos,endPos)){return{remaining:code.substr(endPos-offset),offset:endPos}}function onMatchSuccess(repl){if(pattern.name){repl=_wrapCodeInSpan(pattern.name,repl)}replacements[startPos]={replace:match[0],with:repl};replacementPositions[startPos]=endPos;if(shouldStop){return false}return{remaining:code.substr(endPos-offset),offset:endPos}}function _processGroup(instance,groupKey){const block=match[groupKey];if(!block){return}const group=pattern.matches[groupKey];const language=group.language;const groupToProcess=group.name&&group.matches?group.matches:group;const _getReplacement=function(passedBlock,replaceBlock,matchName){replacement=replaceAtPosition(indexOfGroup(match,groupKey),passedBlock,matchName?_wrapCodeInSpan(matchName,replaceBlock):replaceBlock,replacement);return};if(typeof group==="string"){_getReplacement(block,block,group);return}let localCode;const prism=new Prism(instance.patterns);if(language){localCode=prism.refract(block,language);_getReplacement(block,localCode);return}localCode=prism.refract(block,currentLanguage,groupToProcess.length?groupToProcess:[groupToProcess]);_getReplacement(block,localCode,group.matches?group.name:0)}const groupKeys=keys(pattern.matches);for(const groupKey of groupKeys){_processGroup(instance,groupKey)}return onMatchSuccess(replacement)}function _processCodeWithPatterns(code){for(const pattern of this.patterns){let result=_processPattern(this,pattern,code);while(result){result=_processPattern(this,pattern,result.remaining,result.offset)}}return _processReplacements(code)}this.refract=_processCodeWithPatterns}}class PrismCustom{constructor(element,lang){this.element=element;this.lang=lang;this.pattern=patterns[lang].concat(patterns["generic"])}setLang(lang){this.lang=lang;this.pattern=patterns[lang]|this.pattern}getLang(){return this.lang}getElement(){return this.element}getPattern(){return this.pattern}apply(){const prismInstance=new Prism(this.pattern);this.element.innerHTML=prismInstance.refract(htmlEncode(this.element.innerText)).replaceAll("\n","");if(this.element.innerHTML.replaceAll("\n","")==="")this.element.innerHTML="<br>"}ApplyWithCaret(){const offset=getCaretCharacterOffsetWithin(this.element);this.apply();setCurrentCursorPosition(this.element,offset)}}class Cursor{constructor(element){this.editor=element;this.current=new Map;this.color=[Math.round(Math.random()*255),Math.round(Math.random()*255),Math.round(Math.random()*255)];this.uuid=getRandomString(10);this.request={};document.addEventListener("socket.receive.cursor-moves",(e=>{this.update(e.detail.request.data)}));document.dispatchEvent(new CustomEvent("socket.preprocess",{detail:[this.sendCursorPosition,[this]]}));this.editor.addEventListener("focus",(()=>{if(getCurrentElement()===this.editor)return;this.request=this.cursorRequest()}));this.editor.addEventListener("click",(()=>{if(getCurrentElement()===this.editor)return;this.request=this.cursorRequest()}));this.editor.addEventListener("keypress",(()=>{if(getCurrentElement()===this.editor)return;this.request=this.cursorRequest()}))}cursorRequest(){let element=get_uuid_element();for(const entry of this.current.entries()){if(entry[0]!==this.uuid&&entry[1][1]===element)return{}}if(element.hasAttribute("uuid")){return{type:"cursor-moves",data:{uuid:element.getAttribute("uuid"),userId:this.uuid,color:this.color}}}return{}}sendCursorPosition(cursor){if(cursor&&Object.keys(cursor.request).length>0){triggerEvent("socket.send",cursor.request);cursor.request={}}}update(data){if(this.current.has(data.userId)){this.current.get(data.userId)[0].remove();this.current.get(data.userId)[1].removeAttribute("contenteditable");this.current.get(data.userId)[1].classList.remove("noteditable");this.current.delete(data.userId)}const element=document.querySelector('div[uuid="'+data.uuid+'"]');if(element===null){if(DEBUG)console.log("Cursor position doesn' exist");return}const pointer=document.createElement("div");pointer.classList.add("pointer");pointer.style.top=element.offsetTop+"px";pointer.style.backgroundColor="rgb("+data.color[0]+", "+data.color[1]+", "+data.color[2]+")";if(DEBUG)pointer.id=getRandomString(20);document.getElementById("body").appendChild(pointer);element.setAttribute("contenteditable","false");element.classList.add("noteditable");setTimeout((()=>{if(this.current.has(data.userId)&&Date.now()-this.current.get(data.userId)[2]>9e3){this.current.get(data.userId)[0].remove();this.current.get(data.userId)[1].removeAttribute("contenteditable");this.current.get(data.userId)[1].classList.remove("noteditable");this.current.delete(data.userId)}}),1e4);this.current.set(data.userId,[pointer,element,Date.now()])}}function download(element,link_id){const link=document.getElementById(link_id);link.addEventListener("click",(e=>{const content=element.innerText.replaceAll("\n\n","\n");link.setAttribute("href","data:Content-type, "+escape(content))}))}class Editor{constructor(element,tabSize=4){this.editor=element;this.tabSize=tabSize;this.lines=this.getAll();this.last_request={};this.hasChange=false;this.keepSpace=false;document.dispatchEvent(new CustomEvent("socket.preprocess",{detail:[this.applyDiff,[this]]}));this.editor.addEventListener("keyup",(e=>{if([9,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,112,113,114,115,116,117,118,119,120,121,122,123,144,145,225].includes(e.keyCode))return;switch(e.keyCode){case 13:try{this.keepSpace=false;let new_element=get_uuid_element();let previous_element=new_element.previousElementSibling;let uuid=getRandomString(10);new_element.setAttribute("uuid",uuid);let n_spaces=previous_element.innerText.search(/\S/);if(previous_element.innerText.trimEnd().endsWith(":"))n_spaces+=this.tabSize;if(n_spaces<0)n_spaces=0;new_element.innerHTML=" ".repeat(n_spaces)+new_element.innerHTML;if(new_element.innerText.length===0)new_element.innerHTML="<br>";setCurrentCursorPosition(new_element,n_spaces)}catch(error){if(DEBUG)console.log('Can\'t apply "space" : error during execution')}break;default:if(!e.ctrlKey&&!e.altKey)new PrismCustom(get_uuid_element(),"python").ApplyWithCaret()}this.hasChange=true}));this.editor.addEventListener("paste",(e=>{const s=document.getSelection();function canPaste(lines){if(!getDivOrSectionParent().hasAttribute("uuid"))return false;if(getDivOrSectionParent(s.anchorNode)!==getDivOrSectionParent(s.focusNode))return false;return lines.length===1||s.anchorNode===s.focusNode&&s.anchorOffset===s.focusOffset}let paste=(e.clipboardData||window.clipboardData).getData("text");if(paste){const lines=paste.split("\n");if(canPaste(lines)){if(lines.length>1){const currentElement=get_uuid_element();e.preventDefault();currentElement.innerHTML+=lines[0];new PrismCustom(currentElement,"python").apply();let currentUuid=currentElement.getAttribute("uuid");for(let i=1;i<lines.length;i++){let nextUuid=getRandomString(10);this.new_line(nextUuid,currentUuid,lines[i]);new PrismCustom(this.editor.querySelector('div[uuid="'+nextUuid+'"]'),"python").apply();currentUuid=nextUuid}}}else{e.preventDefault();temporaryCardAlert("Paste Event","Sorry, you can't past over a multiline selection",5e3)}}else{e.preventDefault();temporaryCardAlert("Paste Event","Error with content of your clipboard",5e3)}}));this.editor.addEventListener("keydown",(e=>{if((window.navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&e.keyCode===83){e.preventDefault();document.dispatchEvent(new CustomEvent("socket.send_now",{detail:{requests:[this.request.save()],name:"save"}}));temporaryCardAlert("Save","Your document has been saved",5e3,"#228b22");return}if([9,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,112,113,114,115,116,117,118,119,120,121,122,123,144,145,225].includes(e.keyCode))return;const anchorParent=getDivOrSectionParent(document.getSelection().anchorNode);const focusParent=getDivOrSectionParent(document.getSelection().focusNode);if(!anchorParent.hasAttribute("uuid")||!focusParent.hasAttribute("uuid")||(getCaretCharacterStartOffset(get_uuid_element())===0||getCaretCharacterOffsetWithin(get_uuid_element())===0)&&anchorParent!==focusParent){e.preventDefault();temporaryCardAlert("Override","Sorry, you can't override the first char of this line",5e3);return}switch(e.keyCode){case 9:e.preventDefault();let selection=window.getSelection();selection.collapseToStart();let range=selection.getRangeAt(0);let n_spaces=this.tabSize-getCaretCharacterOffsetWithin(get_uuid_element())%this.tabSize;range.insertNode(document.createTextNode(" ".repeat(n_spaces)));selection.collapseToEnd();new PrismCustom(get_uuid_element(),"python").ApplyWithCaret();break;case 13:if(DEBUG&&this.keepSpace)console.log("Prevent add new line (key is probably maintain)");if(this.keepSpace)e.preventDefault();else this.keepSpace=true;break;case 8:if(getDivOrSectionParent().hasAttribute("uuid")&&getCaretCharacterOffsetWithin(get_uuid_element())===0){e.preventDefault();const currentSibling=get_uuid_element();let previousSibling=get_uuid_element().previousSibling;while(previousSibling&&previousSibling.nodeType!==1){previousSibling=previousSibling.previousSibling}if(previousSibling!==null){const len=previousSibling.innerText.length;previousSibling.innerHTML+=currentSibling.innerHTML;currentSibling.remove();setCurrentCursorPosition(previousSibling,len)}}break}}));document.addEventListener("socket.receive.set-line",(e=>{this.last_request[e.detail.request["data"]["id"]]=e.detail.request["data"]["content"];this.update(e.detail.request["data"]["id"],e.detail.request["data"]["content"])}));document.addEventListener("socket.receive.new-line",(e=>{this.last_request[e.detail.request["data"]["id"]]=e.detail.request["data"]["content"];this.new_line(e.detail.request["data"]["id"],e.detail.request["data"]["previous"],e.detail.request["data"]["content"])}));document.addEventListener("socket.receive.delete-line",(e=>{if(e.detail.request["data"]["id"]in this.last_request)delete this.last_request[e.detail.request["data"]["id"]];this.remove_line(e.detail.request["data"]["id"])}));class Request{constructor(editor){this.editor=editor}setLine(element){return{type:"set-line",data:{id:element.getAttribute("uuid"),content:this.editor.get(element)}}}setLineFromContent(uuid,content){return{type:"set-line",data:{id:uuid,content:content}}}newLine(uuid,previous_uuid,content){return{type:"new-line",data:{id:uuid,previous:previous_uuid,content:content}}}deleteLine(uuid){return{type:"delete-line",data:{id:uuid}}}save(){return{type:"save",data:this.editor.getAll()}}}this.request=new Request(this)}update(uuid,content){let element=this.editor.querySelector('div[uuid="'+uuid+'"]');element.innerText=htmlEncode(content);new PrismCustom(element,"python").apply()}new_line(uuid,previous_uuid,content){if(this.editor.querySelectorAll('div[uuid="'+uuid+'"]').length>0){if(DEBUG)console.log(uuid+" div still exist");return}let element=this.editor.querySelector('div[uuid="'+previous_uuid+'"]');let div=document.createElement("div");div.setAttribute("uuid",uuid);div.innerHTML=content+"<br>";element.parentNode.insertBefore(div,element.nextSibling)}remove_line(uuid){let element=this.editor.querySelector('div[uuid="'+uuid+'"]');if(element)element.remove();else if(DEBUG)console.log("The element with uuid '"+uuid+"' can't be removed: it still doesn't exist")}get(element){if(element.innerText.endsWith("\n")){return element.innerText.slice(0,-1)}else{return element.innerText}}getAll(){let elements=[];for(let element of this.editor.children){elements.push({uuid:element.getAttribute("uuid"),content:element.innerText.replaceAll("\n","")})}return elements}applyDiff(editor){if(editor.hasChange){const oldLines=editor.lines;editor.lines=editor.getAll();triggerMultipleEvent("socket.send",editor.checkDiff(oldLines,editor.lines));editor.hasChange=false}}checkDiff(oldLines,newLines){let oldOrder=[];let oldValues={};for(const line of oldLines){oldOrder.push(line.uuid);oldValues[line.uuid]=line.content}let newOrder=[];let newValues={};for(const line of newLines){newOrder.push(line.uuid);newValues[line.uuid]=line.content}let reqs=[];for(const[i,line]of newLines.entries()){if(oldOrder.includes(line.uuid)){if(oldValues[line.uuid]!==line.content)reqs.push(this.request.setLineFromContent(line.uuid,line.content))}else{reqs.push(this.request.newLine(line.uuid,newLines[i-1].uuid,line.content))}}for(const line of oldLines){if(!newOrder.includes(line.uuid)){reqs.push(this.request.deleteLine(line.uuid))}}let final_reqs=[];let newRejectRequests=[];for(const req of reqs){if(req["type"]==="set-line"&&req["data"]["id"]in this.last_request&&this.last_request[req["data"]["id"]]===req["data"]["content"])continue;if(req["type"]==="new-line"&&req["data"]["id"]in this.last_request){newRejectRequests.push(req);continue}final_reqs.push(req)}for(let newRequest of newRejectRequests){if(!final_reqs.filter((req=>req["type"]==="set-line"&&req["data"]["id"]===newRequest["data"]["id"])).length){delete newRequest["data"]["previous"];newRequest["type"]="set-line";final_reqs.push(newRequest)}}return final_reqs}}class Socket{constructor(doc_id,interval=1e3){this.doc_id=doc_id;this.socket=io();this.join();this.stack={"update text":[]};this.preprocess=[];this.socket.on("text updated",(data=>{for(const request of data["requests"]){if(DEBUG){console.log("RECEIVE",request["type"],request["data"])}const room=data["room"];const event=new CustomEvent("socket.receive."+request["type"],{detail:{request:request,room:room}});document.dispatchEvent(event)}}));document.addEventListener("socket.send",(e=>{if(e.detail.hasOwnProperty("request"))this.stack["update text"].push(e.detail.request);if(e.detail.hasOwnProperty("requests"))this.stack["update text"].push(...e.detail.requests)}));document.addEventListener("socket.send_now",(e=>{this.send(e.detail.name,e.detail.requests)}));document.addEventListener("socket.preprocess",(e=>{const name=e.detail[0];let args=e.detail[1];if(name===undefined)return;if(args===undefined)args=[];const tab=[name,args];if(!this.preprocess.includes(tab)){this.preprocess.push(tab);if(DEBUG)console.log("New socket.preprocess",tab)}}));setInterval((()=>{for(const func of this.preprocess){func[0](...func[1])}if(this.stack["update text"].length){this.send("update text",this.stack["update text"].splice(0,this.stack["update text"].length))}}),interval)}send(name,requests){if(DEBUG&&Array.isArray(requests)){for(const request of requests){console.log("SEND to '"+name+"' with type '"+request["type"]+"'",request["data"])}}this.socket.emit(name,{room:this.doc_id,requests:requests})}join(){this.send("join",{room:this.doc_id})}}function temporaryCardAlert(title,message,duration,color="#1e90ff"){const id=getRandomString(11);const card=document.createElement("div");card.classList.add("alertCard");card.style.backgroundColor=color;card.id=id;card.innerHTML="<h3>"+title+"</h3><p>"+message+"</p>";document.getElementById("body").appendChild(card);setTimeout((()=>{card.remove()}),duration)}class Cookie{constructor(name){this.name=name}setCookie(cvalue,exdays){let d=new Date;d.setTime(d.getTime()+exdays*24*60*60*1e3);let expires="expires="+d.toUTCString();document.cookie=this.name+"="+cvalue+";"+expires+";path=/"}getCookie(){let decodedCookie=decodeURIComponent(document.cookie);let ca=decodedCookie.split(";");for(let i=0;i<ca.length;i++){let c=ca[i];while(c.charAt(0)===" "){c=c.substring(1)}if(c.indexOf(this.name+"=")===0){return c.substring((this.name+"=").length,c.length)}}return""}}function getRandomString(length){var randomChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";var result="";for(var i=0;i<length;i++){result+=randomChars.charAt(Math.floor(Math.random()*randomChars.length))}return result}class Welcome{constructor(){if(new Cookie("welcome").getCookie()===""){document.getElementById("main").classList.add("blur-background");document.getElementById("welcome").style.display="block"}}get_it(){document.getElementById("main").classList.remove("blur-background");document.getElementById("welcome").style.display="None";let cookie=new Cookie("welcome");cookie.setCookie("true",30)}}let welcome=new Welcome;function createRange(node,chars,range){if(!range){range=document.createRange();range.selectNode(node);range.setStart(node,0)}if(chars.count===0){range.setEnd(node,chars.count)}else if(node&&chars.count>0){if(node.nodeType===Node.TEXT_NODE){if(node.textContent.length<chars.count){chars.count-=node.textContent.length}else{range.setEnd(node,chars.count);chars.count=0}}else{for(var lp=0;lp<node.childNodes.length;lp++){range=createRange(node.childNodes[lp],chars,range);if(chars.count===0){break}}}}return range}function setCurrentCursorPosition(element,chars){if(chars>=0){let selection=document.getSelection();let range=createRange(element,{count:chars});if(range){range.collapse(false);selection.removeAllRanges();selection.addRange(range)}}}function getCaretCharacterOffsetWithin(element){let caretOffset=0;let doc=element.ownerDocument||element.document;let win=doc.defaultView||doc.parentWindow;let sel;if(typeof win.getSelection!="undefined"){sel=win.getSelection();if(sel.rangeCount>0){let range=win.getSelection().getRangeAt(0);let preCaretRange=range.cloneRange();preCaretRange.selectNodeContents(element);preCaretRange.setEnd(range.endContainer,range.endOffset);caretOffset=preCaretRange.toString().length}}else if((sel=doc.selection)&&sel.type!=="Control"){let textRange=sel.createRange();let preCaretTextRange=doc.body.createTextRange();preCaretTextRange.moveToElementText(element);preCaretTextRange.setEndPoint("EndToEnd",textRange);caretOffset=preCaretTextRange.text.length}return caretOffset}function getCaretCharacterStartOffset(element){let caretOffset=0;let doc=element.ownerDocument||element.document;let win=doc.defaultView||doc.parentWindow;let sel;if(typeof win.getSelection!="undefined"){sel=win.getSelection();if(sel.rangeCount>0){let range=win.getSelection().getRangeAt(0);let preCaretRange=range.cloneRange();preCaretRange.selectNodeContents(element);preCaretRange.setEnd(range.startContainer,range.startOffset);caretOffset=preCaretRange.toString().length}}else if((sel=doc.selection)&&sel.type!=="Control"){let textRange=sel.createRange();let preCaretTextRange=doc.body.createTextRange();preCaretTextRange.moveToElementText(element);preCaretTextRange.setEndPoint("EndToEnd",textRange);caretOffset=preCaretTextRange.text.length}return caretOffset}function getCurrentElement(){return window.getSelection().getRangeAt(0).startContainer}function get_uuid_element(child=getCurrentElement()){try{if(child.nodeType!==Node.TEXT_NODE&&child.hasAttribute("uuid"))return child;else return get_uuid_element(child.parentElement)}catch(e){return undefined}}function getDivOrSectionParent(child=getCurrentElement()){if(child.nodeName==="DIV"||child.nodeName==="SECTION")return child;else return getDivOrSectionParent(child.parentElement)}function triggerEvent(name,request){document.dispatchEvent(new CustomEvent(name,{detail:{request:request}}))}function triggerMultipleEvent(name,requests){document.dispatchEvent(new CustomEvent(name,{detail:{requests:requests}}))}function htmlEncode(str){return String(str).replaceAll("<","&lt;").replaceAll(">","&gt;")}const DEBUG=true;const socket=new Socket(doc_id);const editor=new Editor(document.getElementById("editor"));const cursor=new Cursor(document.getElementById("editor"));for(const child of document.getElementById("editor").children){new PrismCustom(child,"python").ApplyWithCaret()}download(document.getElementById("editor"),"download");